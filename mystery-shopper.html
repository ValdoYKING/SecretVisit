<!DOCTYPE html>
<html lang="es">

<head>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <title>Solo Myastery's Shopper's</title>

  <script type="module" src="lib/js/ejecuta.js"></script>
  <script type="module" src="lib/js/muestraError.js"></script>
  <script type="module" src="./js/const/ROL_MYSTERY_SHOPPER.js"></script>
  <script type="module" src="./js/custom/mi-nav-mystery.js"></script>
  <script type="module" src="./js/Sesion.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script type="module" src="./js/custom/footer.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            clifford: '#da373d',
          }
        }
      }
    }
  </script>
</head>

<body onload="ejecuta('srv/srvSesion.php')
  .then(objeto => {
   const sesion = new Sesion(objeto);
   if (sesion.rolIds.has(ROL_MYSTERY_SHOPPER)) {
    nav.sesion = sesion;
    main.hidden = false;
    loadData(); // Llamamos a la función loadData al cargar la página
   } else {
    location.href = 'index.html';
   }
  })
  .catch(muestraError)">

  <mi-nav id="nav"></mi-nav>

  <main id="main">
    <div class="p-4 sm:ml-64">
      <button class="bg-purple-500 text-white text-sm font-bold rounded-lg p-2 m-2 justify-end item-end w-1/6 mx-auto"
        type="button" id="logout" onclick="ejecuta('srv/srvLogout.php')
                    .then(json => location.href = 'index.html')
                    .catch(muestraError)">
        Terminar sesión
      </button>
      <div class="p-4 border-white-200  border-dashed rounded-lg dark:border-white-700 shadow-xl my-2">
        <p class="text-4xl text-white-400 dark:text-white-500 uppercase font-bold">
          Mis visitas <span class="text-white-500 text-purple-500"> secretas</span>
        <p class="text-md text-white-400 dark:text-white-500 uppercase font-bold">
          Contesta las encuestas de las empresas y gana recompensas
          <i class="fas fa-user-secret">
          </i>

        </p>

      </div>

      <div class="grid gap-4 mb-4 sm:grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4" id="lista">

        <!-- Aquí se agregarán dinámicamente los elementos de las empresas -->

      </div>
    </div>
  </main>

  <script>
    const loadData = async () => {
      try {
        const response = await fetch('srv/srvMuestraEncuestasMystery.php');
        const data = await response.json(); // Obtener la respuesta como un objeto JSON
        if (data.length === 0) {
          lista.innerHTML = '<p>No hay empresas registradas</p>';
          return;
        }

        lista.innerHTML = ''; // Limpiamos el contenido previo de la lista
        data.forEach(encuesta => {
          const divEncuesta = document.createElement('div');
          divEncuesta.classList.add('flex', 'items-center', 'justify-center', 'rounded', 'bg-white-50', 'h-28', 'bg-white', 'shadow-lg', 'hover:bg-purple-400', 'hover:text-white', 'hover:cursor-pointer', 'mb-4', 'p-4', 'h-96');

          const imgEmpresa = document.createElement('img');
          imgEmpresa.src = "#" // URL de la imagen de la empresa
          imgEmpresa.alt = 'Logo de la empresa';
          imgEmpresa.classList.add('w-26', 'h-20', 'rounded-full');

          const divInfo = document.createElement('div');
          divInfo.classList.add('ms-4');

          const nombreEmpresa = document.createElement('p');
          nombreEmpresa.classList.add('text-md', 'font-bold', 'text-white-400');
          nombreEmpresa.textContent = encuesta.nombreEmpresa; // Nombre de la empresa

          const cantidadPreguntas = document.createElement('p');
          cantidadPreguntas.classList.add('text-purple-500');
          cantidadPreguntas.innerHTML = `${encuesta.totalPreguntas} <span class="text-black preguntas">preguntas</span>`; // Total de preguntas

          const tiempoRestante = document.createElement('p');
          tiempoRestante.classList.add('text-sm', 'text-purple-700');
          tiempoRestante.innerHTML = `${encuesta.totalPreguntas} <span class="text-black">min restantes</span>`; // Tiempo restante

          const botonVer = document.createElement('button');
          botonVer.classList.add('flex', 'w-full', 'm-auto', 'justify-center', 'text-center', 'bg-purple-500', 'hover:bg-white-700', 'text-white', 'rounded-lg', 'font-bold', 'rounded', 'shadow-lg', 'hover:bg-white', 'hover:text-purple-400');
          botonVer.type = 'submit';
          botonVer.textContent = 'Ver';
          botonVer.onclick = () => {
            location.href = `cuestionarios.html`;
          }

          divInfo.appendChild(nombreEmpresa);
          divInfo.appendChild(cantidadPreguntas);

          divInfo.appendChild(botonVer);


          divEncuesta.appendChild(divInfo);

          lista.appendChild(divEncuesta);
        });
      } catch (error) {
        console.error('Error al cargar los datos:', error);
      }
    };


  </script>

</body>

</html>