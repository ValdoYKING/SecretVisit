
<!DOCTYPE html>
<html lang="es">

<head>

 <meta charset="UTF-8">
 <meta name="viewport" content="width=device-width">

 <title>Cuestionario</title>
  <script src="https://cdn.tailwindcss.com"></script>
   <script type="module" src="./js/custom/mi-nav.js"></script>
 <script type="module" src="lib/js/ejecuta.js"></script>
 <script type="module" src="lib/js/muestraError.js"></script>
  <script type="module" src="lib/js/submitForma.js"></script>
 <script type="module" src="lib/js/muestraInnerHtml.js"></script>
 <script type="module" src="lib/js/muestraObjeto.js"></script>

   <script type="module" src="./js/custom/footer.js"></script>

    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              clifford: '#da373d',
            }
          }
        }
      }
    </script>
<script>
    const parametros = new URL(location.href).searchParams
</script>
</head>

<body>
   
<body onload="loadData()">

<script>
  const loadData = async () => {
    await getQuestions()
    await getCompanys()
    async function getQuestions() {
      try {
        const response = await fetch('srv/srvConsultarPreguntas.php');
        const data = await response.json();
        muestraInnerHtml(lista, data);
      } catch (error) {
        muestraError(error);
      }
    }
    async function getCompanys(id) {
      
        id = 2;
        const url = 'srv/srvConsultarEmpresabyId.php';
        const request = {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ id }),
        };
        try {
          const response = await fetch(url, request);
          const data = await response.json();
          //RENDERIZAR LOS SELECT CON LOS DATOS DE LA EMPRESA
          const select = document.getElementById('empresa');
          console.log(data);
            if (data.length === 0) {
          data.forEach((empresa) => {
            const option = document.createElement('option');
            option.value = empresa.EMP_ID;
            option.textContent = empresa.EMP_NOMBRE;
            select.appendChild(option);
          });
        } else {
          const option = document.createElement('option');
          option.textContent = 'No hay empresas';
          select.appendChild(option);
        }


          

async function cargarEmpresas() {
            try {
                const respuesta = await fetch('srv/srvObtenerEmpresas.php');
                const empresas = await respuesta.json();
                const select = document.getElementById('empresaId');
                select.innerHTML = ''; // Limpiar contenido anterior
                empresas.forEach(empresa => {
                    const option = document.createElement('option');
                    option.value = empresa.id;
                    option.textContent = empresa.nombre;
                    select.appendChild(option);
                });
            } catch (error) {
                console.error('Error al cargar las empresas:', error);
            }
        }

  async function cargarPreguntas() {
            try {
                const respuesta = await fetch('srv/srvObtenerPreguntas.php');
                const preguntas = await respuesta.json();
                const preguntasContainer = document.getElementById('preguntasContainer');
                preguntasContainer.innerHTML = ''; // Limpiar contenido anterior
                preguntas.forEach(pregunta => {
                    const checkbox = document.createElement('input');
                    checkbox.type = 'checkbox';
                    checkbox.name = 'preguntaId[]'; // Cambiar el nombre para enviarlo como un arreglo
                    checkbox.value = pregunta.id;
                    const th = document.createElement('th');
                    const th2 = document.createElement('th');
                    const p = document.createElement('p');
                    p.textContent = "categoria";
            th.textContent = pregunta.pregunta ;
            th2.textContent = pregunta.id; // Corrección aquí
                    const tr = document.createElement('tr');
                    tr.appendChild(th2);
                    tr.appendChild(th).appendChild(p);
                    tr.appendChild(checkbox);
                    checkbox.addEventListener('change',function() {
                        if (this.checked) { 
                            preguntasSeleccionadas++
                        } else {
                            preguntasSeleccionadas--
                        }
                        contador();
                    } );
                    preguntasContainer.appendChild(tr);
                });
            } catch (error) {
                console.error('Error al cargar las preguntas:', error);
            }
        }
  
  function consultarpregunta() {
    fetch('srv/srvConsultarPreguntas.php')
    .then(response => response.text() )
    .then(render => muestraInnerHtml('lista',render))
    .catch(error => muestraError(error));
  }
  

  function buscaEmpresa(parametros){
    fetch('srv/srvBusquedaEmpresa.php' + parametros)
    .then(render => muestraObjeto('cuestionario',render))
    .catch(error => muestraError(error));
  }
     <mi-nav id="nav"></mi-nav>

  window.onload = function() {
  
   window.onload = function() {
    let parametros = '?parametro1=valor1&parametro2valor2';
    buscaEmpresa(parametros)
    consultarpregunta()
  }
  }
</script>
   <mi-nav  id="nav"></mi-nav>
  <div class="container mx-auto shadow-lg p-6 bg-white rounded-lg"">
<button class="bg-gray-500 hover:bg-black-700 border-white text-white font-bold border-sm py-2 px-2 rounded" onclick="location.href ='analista.html'">
  Volver
</button>
      <h1 class="text-purple-700 font-bold text-start text-3xl mb-4 uppercase my-10 ">+ Crear un Cuestionario</h1>
      
        <select name="empresa" id="empresa" class="bg-white shadow-lg
                w-1/2 mx-auto rounded-md border-2 border-gray-300 p-2" required>
          <option value="">Selecciona una empresa</option>
        </select>



  <form id="cuestionario" onsubmit="submitForma('srv/srvCrearCuestionario.php' + parametros, event, cuestionario)
  .then(modelo => location.href = 'creaCuestionario.html')
    .catch(muestraError)">
           <label for="empresaId">Seleccionar Empresa:</label>
           <select name="empresaId" id="empresaId">
               <!-- Aquí se cargarán las opciones de las empresas -->
           </select>
            <div>
            
            
        <label for="pregunta" class="text-black font-bold mb-2 uppercase text-start" >
          <p> Numero de preguntas:  <span id="contadorPreguntas">0</span></p>
            </div>

  <table class="w-full text-sm text-left rtl:text-right text-gray-500 dark:text-gray-400">
     <thead class="text-xs text-gray-700 uppercase bg-gray-50 dark:bg-gray-700 dark:text-gray-400">

      <tr>
        <th scope="col" class="px-6 py-3">N° </th>
         <td class="px-6 py-4"> Pregunta </td>
         <td class="px-6 py-4">Agregar a Cuestionario</td>
      </tr>
    </thead>
    <tbody id="lista"> 
      <input type="text" name="id" id="" >
      <input type="text" name="cue" class="text-black font-bold mb-2 uppercase text-start" >
    </tbody>
  </table>
  <p style="display: none;">CUE: <span id="cueDisplay"></span></p>
  <p style="display: none;">Rol: <span id="rolDisplay"></span></p>
  <input type="hidden" name="cue" id="cueInput" value="">
     <button
        class="bg-purple-500 m-4 px-4 py-2 rounded-md w-2/4 mx-auto flex text-white mt-10  font-bold  hover:bg-purple-400 hover:text-white text-center justify-center "
       type="submit" >+ Crear  </button>

   <hr class="">
  <p class="text-start text-purple-700 font-bold text-3xl mb-4 uppercase my-10 " > + Añade tu pregunta </button>
  </form>


  <div class="container 3/4 mx-auto">
    
   <h1 class="text-black font-bold text-center text-lg mb-4">¿Qué pregunta deseas ingresar?</h1>
          <form class=" mx-auto" id="forma" onsubmit="submitForma('srv/srvRegistroPregunta.php',event,forma)
            .then(modelo => location.href = 'creaCuestionario.html')
            .catch(muestraError)">
            <label
                class="block text-lg font-bold text-gray-700"
              >Pregunta #</label>
            <input type="text" name="apregunta" class="bg-white shadow-lg
                w-1/2 mx-auto rounded-md border-2 border-gray-300 p-2" placeholder="Ingresa tu pregunta"
               required>
             
            <button 
                class="bg-purple-500 m-4 px-4 py-2 rounded-lg text-white font-bold hover:bg-purple-400  hover:text-white text-center justify-center"
              type="submit">Agregar Pregunta </button>
          </form>
        
    </div>
     </div> 
   <footer id="footer"></footer><h1>Hola</h1>

</body>

</html>